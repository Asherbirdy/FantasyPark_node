import{_ as B}from"./NavBar-1a12c13d.js";import{_ as N}from"./Button-f9afef36.js";import{_ as U,e as p,n as $,l as T,y as P,o as v,c as _,u as s,b as t,t as l,a as f,w as y,j as M,f as z,g as O,i as j,F as D,z as E,h as J,A as L,k as g,p as R,d as Y,m as q}from"./index-112d644b.js";import{a as G}from"./index-e64505e3.js";const r=h=>(R("data-v-45ee3554"),h=h(),Y(),h),H={key:0,class:"modal-overlay"},K={class:"modal"},Q={class:"m-wrapper"},W=r(()=>t("h3",null,"一組帳號只能在同日期買五張票",-1)),X={class:"m-userTickets"},Z=r(()=>t("p",null,"目前",-1)),tt=r(()=>t("p",null,"可再購買",-1)),et=r(()=>t("p",{class:"m-title"},"購票須知",-1)),at=r(()=>t("div",{class:"m-ticketInfo"},[t("div",null,[t("p",null,"成人票 : 18歲以上"),t("p",null,"兒童票 :08~ 18歲")]),t("div",null,[t("p",null,"優待票 :需有殘障手冊證明"),t("p",null,"免費:08歲以下免費")])],-1)),nt={class:"btn"},st={class:"cart"},ot={class:"timeInfoBar"},lt={class:"timepicker"},it=r(()=>t("h2",null,"日期：",-1)),ct=["min"],dt={key:1},ut={class:"ticketInfo"},rt={class:"counter"},pt=["onClick"],vt=["onClick"],_t=L('<section data-v-45ee3554><div class="payment" data-v-45ee3554><h3 class="payment-title" data-v-45ee3554>信用卡支付</h3><div class="payment-content" data-v-45ee3554><div data-v-45ee3554><p data-v-45ee3554>信用卡</p><input class="big-input" type="text" placeholder="4136815292895026" data-v-45ee3554></div><div class="twoInputBox" data-v-45ee3554><div data-v-45ee3554><p data-v-45ee3554>過期日</p><input class="small-input" type="text" placeholder="10/18" data-v-45ee3554></div><div data-v-45ee3554><p data-v-45ee3554>CVC</p><input class="small-input" type="text" placeholder="212" data-v-45ee3554></div></div><div data-v-45ee3554><p data-v-45ee3554>優惠碼</p><input class="big-input" type="text" data-v-45ee3554></div></div></div></section>',1),mt=r(()=>t("hr",null,null,-1)),ht={class:"pricePaybox"},ft={__name:"CartView",setup(h){const k=p(!1),o=p(""),C=p(0),d=p({allTicketsInfo:[],count:0}),c=p({count:0,findTodayUnuseTicket:[]});p(),$(async()=>{var a;try{const e=await T.get("/api/v1/ticketCategory");d.value.allTicketsInfo=e.data.allTicketsInfo,d.value.allTicketsInfo.forEach(n=>{n.amount=0}),d.value.count=e.data.count;const i=(await T.get("/api/v1/userTickets/getTickets")).data;if(i.length>0){const n=(a=i[0])==null?void 0:a.ticketDate,w=G(n);c.value.count=i.length,c.value.findTodayUnuseTicket=i,o.value=w}}catch(e){console.error(e);return}});const I=function(){k.value=!k.value},S=(a,e)=>{m.value+(e?1:-1)<=5?e?5-c.value.count-m.value>0?(a.amount=(a.amount||0)+1,x()):alert("一組帳號只能在同日期買五張票"):a.amount>0&&(a.amount--,x()):alert("一組帳號只能買五張票")},V=()=>{const a=new Date,e=a.getFullYear(),u=String(a.getMonth()+1).padStart(2,"0"),i=String(a.getDate()).padStart(2,"0");return`${e}-${u}-${i}`};function x(){C.value=d.value.allTicketsInfo.reduce((a,e)=>a+(e.amount||0)*e.price,0)}const m=P(()=>d.value.allTicketsInfo.reduce((a,e)=>a+(e.amount||0),0));let b;async function F(){if(!o.value)return alert("請輸入日期");if(m.value===0)return alert("請加購票券");clearTimeout(b),b=setTimeout(async()=>{const a=d.value.allTicketsInfo.filter(e=>e.amount!==0).map(e=>({ticketDate:o.value,ticketId:e._id,amount:e.amount}));if(o.value&&m.value>0)try{const e=await T.post("/api/v1/order",a);localStorage.setItem("order",JSON.stringify(e.data)),q.push("/user/order")}catch(e){alert(e.response.data.msg)}},500)}return(a,e)=>{const u=N,i=B;return v(),_(D,null,[s(k)?(v(),_("div",H,[t("div",K,[t("div",Q,[W,t("div",X,[t("div",null,[Z,t("h4",null,l(s(o)?s(o):"無購買票")+" "+l(s(c).count!==0?`有${s(c).findTodayUnuseTicket.length}張`:""),1)]),t("div",null,[tt,t("h4",null,l(5-(s(c).findTodayUnuseTicket?s(c).findTodayUnuseTicket.length:0))+"張票 ",1)])]),et,at,t("div",nt,[f(u,{btnFontSize:"0.5",onClick:I},{default:y(()=>[g("返回")]),_:1})])])])])):M("",!0),f(i,{statusIdx:1,class:"navbar"}),t("main",null,[t("section",null,[t("div",st,[t("div",ot,[t("div",lt,[it,s(c).count===0?z((v(),_("input",{key:0,type:"date","onUpdate:modelValue":e[0]||(e[0]=n=>j(o)?o.value=n:null),onChange:e[1]||(e[1]=(...n)=>a.handleDateChange&&a.handleDateChange(...n)),class:"date-input",min:V()},null,40,ct)),[[O,s(o)]]):(v(),_("h2",dt,l(s(o)),1))]),f(u,{btnFontSize:"0.3rem",onClick:I,class:"btn"},{default:y(()=>[g("暸解票券資訊")]),_:1})]),(v(!0),_(D,null,E(s(d).allTicketsInfo,(n,w)=>(v(),_("div",{class:"ticketsOrder",key:n._id},[t("div",ut,[t("h4",null,l(n.ticketType)+" ("+l(n.fastTrack?"快速通關":"一般")+") ",1),t("p",null,l(n.price)+"元",1)]),t("div",rt,[t("div",{class:"box",onClick:A=>S(n,!1)}," - ",8,pt),t("p",null,l(n.amount||0),1),t("div",{class:"box",onClick:A=>S(n,!0)}," + ",8,vt)])]))),128))])]),_t]),mt,t("div",ht,[t("h3",null,"總價:"+l(s(C))+"元 ; 票數:"+l(s(m))+"張",1),f(u,{btnFontSize:"0.3rem",onClick:J(F,["prevent"]),btnColor:"#0694A7"},{default:y(()=>[g("支付")]),_:1},8,["onClick"])])],64)}}},Ct=U(ft,[["__scopeId","data-v-45ee3554"]]);export{Ct as default};
