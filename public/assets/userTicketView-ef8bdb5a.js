import{_ as y,d,n as x,l as $,o,c as i,b as t,F as C,q as R,t as l,u as a,p as B,k as S,h as w,a as p,s as P,x as z,y as I,w as f,j as h,z as G,m as U}from"./index-f70f97f4.js";import{g as M,a as V}from"./index-71a875f6.js";import{_ as q}from"./Button-829e9c6d.js";import{b as j}from"./browser-e933942f.js";import{_ as L}from"./NavBar-e53cf323.js";const O=c=>(B("data-v-c0e92079"),c=c(),S(),c),A=O(()=>t("div",{class:"title"},[t("h2",null,"票券紀錄")],-1)),E={class:"responsive-table"},J=O(()=>t("thead",null,[t("tr",null,[t("th",null,"日期"),t("th",null,"狀態"),t("th",null,"票型"),t("th",null,"價格")])],-1)),K={__name:"TicketHistory",setup(c){const e=d();return x(()=>{$.get("/api/v1/userTickets/getTickets").then(n=>{e.value=n.data,console.log(e.value)})}),(n,_)=>(o(),i(C,null,[A,t("section",null,[t("table",E,[J,t("tbody",null,[(o(!0),i(C,null,R(a(e),s=>(o(),i("tr",{key:s._id},[t("td",null,l(s.ticketDate&&a(M)(s.ticketDate)),1),t("td",null,l(s.status),1),t("td",null,l(s.ticketCategoryId.ticketType)+" "+l(s.ticketCategoryId.fastTrack?"快速通關":"一般票"),1),t("td",null,l(s.currentPurchasePrice)+"元",1)]))),128))])])])],64))}},W=y(K,[["__scopeId","data-v-c0e92079"]]);const X=["src"],Y={__name:"QRCodeGenerator",props:{id:String},setup(c){const e=c,n=d(""),_=async()=>{if(e.id.trim()==="")return;const s={width:100,height:100},k=await j.toDataURL(e.id,s);n.value=k};return x(()=>{_()}),(s,k)=>n.value?(o(),i("img",{key:0,src:n.value,alt:"QR Code"},null,8,X)):w("",!0)}},Q=y(Y,[["__scopeId","data-v-8b36f294"]]);const Z={class:"ticket-box-content"},tt={__name:"Tickets",props:["ticketData"],setup(c){const e=c;return(n,_)=>{const s=Q;return o(),i("div",{class:"ticket-card",style:P({backgroundColor:a(V)(e.ticketData.status,e.ticketData.ticketCategoryId.ticketType)})},[t("div",Z,[t("div",null,[t("p",null,l(e.ticketData.status==="used"?"已使用":"未使用"),1)]),t("h3",null,l(e.ticketData.ticketCategoryId.ticketType),1),t("h4",null,l(e.ticketData.ticketCategoryId.fastTrack?"快速通關":"一般票"),1)]),p(s,{id:e.ticketData._id},null,8,["id"])],4)}}},et=y(tt,[["__scopeId","data-v-295f1ec1"]]);const st={key:0,class:"modal-overlay"},nt={class:"box-content"},ot={class:"status"},ct={class:"ticketitle"},at={key:1,class:"refundPrice-rwd"},lt={key:2,class:"btn-wrap"},rt={key:3,class:"btn-wrap"},it={key:1,class:"refundPrice"},_t={__name:"TicketInfoRefundModal",props:{isOpen:Boolean,currentTicketData:Object},setup(c,{emit:e}){const n=c,_=d(!0),s=d(!0),k=()=>{_.value=!0,s.value=!0,e("close"),e("refresh-tickets")},u=d(n.currentTicketData);z(()=>n.currentTicketData,r=>{u.value=r});function g(){_.value=!1,s.value=!1}const b=async()=>{$.get(`/api/v1/userTickets/refund/${u.value._id}`).then(r=>{_.value=!0,s.value=!0,e("close"),e("refresh-tickets")}).catch(r=>{console.log(r)})};return(r,D)=>{const T=Q,v=q;return n.isOpen?(o(),i("div",st,[t("div",{class:"card",style:P({backgroundColor:a(V)(a(u).status,a(u).ticketCategoryId.ticketType)})},[t("div",nt,[t("div",ot,[t("p",null,l(a(u).status==="used"?"已使用":"未使用"),1)]),t("div",ct,l(a(u).ticketCategoryId.ticketType),1),t("h3",null,l(a(u).ticketCategoryId.fastTrack?"快速通關":"一般票"),1),a(_)?(o(),I(T,{key:0,id:a(u)._id,class:"qrcode-rwd"},null,8,["id"])):(o(),i("div",at,l(n.currentTicketData.currentPurchasePrice)+"元 ",1)),a(s)?(o(),i("div",lt,[p(v,{btnFontSize:"0.5",onClick:k},{default:f(()=>[h("返回")]),_:1}),p(v,{class:"btn",btnColor:"rgba(0,0,0,0)",btnHoverColor:"none",onClick:g},{default:f(()=>[h("退票")]),_:1})])):(o(),i("div",rt,[p(v,{btnFontSize:"0.5",onClick:k},{default:f(()=>[h("不想退票")]),_:1}),p(v,{class:"btn",btnColor:"rgba(0,0,0,0)",btnHoverColor:"none",onClick:b},{default:f(()=>[h("我想退票")]),_:1})]))]),a(_)?(o(),I(T,{key:0,id:a(u)._id,class:"qrcode"},null,8,["id"])):(o(),i("div",it,l(n.currentTicketData.currentPurchasePrice)+"元 ",1))],4)])):w("",!0)}}},ut=y(_t,[["__scopeId","data-v-83a43388"]]);const dt=c=>(B("data-v-f300d4d1"),c=c(),S(),c),pt={class:"title"},kt={class:"ticketBox"},vt={key:0,class:"noTicketBox"},ft=dt(()=>t("h2",null,"目前沒有訂票",-1)),ht={__name:"userTicketView",setup(c){const e=d([]),n=d(!1),_=d(null),s=d(!1),k=G(()=>{if(e.value.length>0){const r=e.value[0];return M(r.ticketDate)}});x(async()=>{g()});const u=r=>{r.status!=="used"&&(_.value=r,n.value=!0)},g=async()=>{const r=await $.get("/api/v1/userTickets/getTickets");e.value=r.data,e.value.length===0?s.value=!0:s.value=!1};function b(){U.push("/user/cart")}return(r,D)=>{const T=L,v=ut,F=et,H=q,N=W;return o(),i(C,null,[p(T),p(v,{isOpen:n.value,onClose:D[0]||(D[0]=m=>n.value=!1),currentTicketData:_.value,onRefreshTickets:g},null,8,["isOpen","currentTicketData"]),t("main",null,[t("div",pt,[t("h3",null,l(a(k)),1)]),t("div",kt,[(o(!0),i(C,null,R(e.value,(m,yt)=>(o(),I(F,{key:m._id,ticketData:m,onClick:gt=>u(m)},null,8,["ticketData","onClick"]))),128)),s.value?(o(),i("div",vt,[ft,p(H,{onClick:b},{default:f(()=>[h("前往訂票頁面")]),_:1})])):w("",!0)]),p(N)])],64)}}},It=y(ht,[["__scopeId","data-v-f300d4d1"]]);export{It as default};
