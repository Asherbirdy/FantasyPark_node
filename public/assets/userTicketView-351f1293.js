import{_ as Q}from"./TicketHistory-47a76223.js";import{_ as $}from"./Button-ed1bddf3.js";import{b as F}from"./browser-e933942f.js";import{_ as C,e as u,n as R,o as c,c as l,j as I,b as e,t as _,a as d,q as B,u as n,s as N,x as D,w as y,k as m,l as x,y as z,F as w,z as G,m as U,p as j,d as L}from"./index-a380e3af.js";import{g as S,a as A}from"./index-e64505e3.js";import{_ as E}from"./NavBar-8328d5df.js";const J=["src"],K={__name:"QRCodeGenerator",props:{id:String},setup(r){const t=r,s=u(""),a=async()=>{if(t.id.trim()==="")return;const o={width:100,height:100},p=await F.toDataURL(t.id,o);s.value=p};return R(()=>{a()}),(o,p)=>s.value?(c(),l("img",{key:0,src:s.value,alt:"QR Code"},null,8,J)):I("",!0)}},H=C(K,[["__scopeId","data-v-8b36f294"]]);const W={class:"ticket-box-content"},X={__name:"Tickets",props:["ticketData"],setup(r){const t=r;return(s,a)=>{const o=H;return c(),l("div",{class:"ticket-card",style:B({backgroundColor:n(S)(t.ticketData.status,t.ticketData.ticketCategoryId.ticketType)})},[e("div",W,[e("div",null,[e("p",null,_(t.ticketData.status==="used"?"已使用":"未使用"),1)]),e("h3",null,_(t.ticketData.ticketCategoryId.ticketType),1),e("h4",null,_(t.ticketData.ticketCategoryId.fastTrack?"快速通關":"一般票"),1)]),d(o,{id:t.ticketData._id},null,8,["id"])],4)}}},Y=C(X,[["__scopeId","data-v-295f1ec1"]]);const Z={key:0,class:"modal-overlay"},tt={class:"box-content"},et={class:"status"},st={class:"ticketitle"},ot={key:1,class:"refundPrice-rwd"},nt={key:2,class:"btn-wrap"},ct={key:3,class:"btn-wrap"},at={key:1,class:"refundPrice"},it={__name:"TicketInfoRefundModal",props:{isOpen:Boolean,currentTicketData:Object},setup(r,{emit:t}){const s=r,a=u(!0),o=u(!0),p=()=>{a.value=!0,o.value=!0,t("close"),t("refresh-tickets")},i=u(s.currentTicketData);N(()=>s.currentTicketData,v=>{i.value=v});function b(){a.value=!1,o.value=!1}const T=async()=>{x.get(`/api/v1/userTickets/refund/${i.value._id}`).then(v=>{a.value=!0,o.value=!0,t("close"),t("refresh-tickets")}).catch(v=>{console.log(v)})};return(v,k)=>{const f=H,g=$;return s.isOpen?(c(),l("div",Z,[e("div",{class:"card",style:B({backgroundColor:n(S)(n(i).status,n(i).ticketCategoryId.ticketType)})},[e("div",tt,[e("div",et,[e("p",null,_(n(i).status==="used"?"已使用":"未使用"),1)]),e("div",st,_(n(i).ticketCategoryId.ticketType),1),e("h3",null,_(n(i).ticketCategoryId.fastTrack?"快速通關":"一般票"),1),n(a)?(c(),D(f,{key:0,id:n(i)._id,class:"qrcode-rwd"},null,8,["id"])):(c(),l("div",ot,_(s.currentTicketData.currentPurchasePrice)+"元 ",1)),n(o)?(c(),l("div",nt,[d(g,{btnFontSize:"0.5",onClick:p},{default:y(()=>[m("返回")]),_:1}),d(g,{class:"btn",btnColor:"rgba(0,0,0,0)",btnHoverColor:"none",onClick:b},{default:y(()=>[m("退票")]),_:1})])):(c(),l("div",ct,[d(g,{btnFontSize:"0.5",onClick:p},{default:y(()=>[m("不想退票")]),_:1}),d(g,{class:"btn",btnColor:"rgba(0,0,0,0)",btnHoverColor:"none",onClick:T},{default:y(()=>[m("我想退票")]),_:1})]))]),n(a)?(c(),D(f,{key:0,id:n(i)._id,class:"qrcode"},null,8,["id"])):(c(),l("div",at,_(s.currentTicketData.currentPurchasePrice)+"元 ",1))],4)])):I("",!0)}}},rt=C(it,[["__scopeId","data-v-83a43388"]]);const M=r=>(j("data-v-d176b38e"),r=r(),L(),r),lt={class:"title"},ut={class:"ticketBox"},_t={key:0,class:"noTicketBox"},dt=M(()=>e("h2",null,"目前沒有訂票",-1)),pt=M(()=>e("div",{class:"title"},[e("h2",null,"使用紀錄")],-1)),kt={__name:"userTicketView",setup(r){const t=u([]),s=u(!1),a=u(null),o=u(!1),p=u([]),i=z(()=>{if(t.value.length>0){const k=t.value[0];return A(k.ticketDate)}});R(async()=>{T()});const b=k=>{k.status!=="used"&&(a.value=k,s.value=!0)},T=async()=>{const k=await x.get("/api/v1/userTickets/getTickets");t.value=k.data,t.value.length===0?o.value=!0:o.value=!1;const f=await x.get("/api/v1/userTickets/ticketHistory");p.value=f.data};function v(){U.push("/user/cart")}return(k,f)=>{const g=E,V=rt,q=Y,O=$,P=Q;return c(),l(w,null,[d(g),d(V,{isOpen:s.value,onClose:f[0]||(f[0]=h=>s.value=!1),currentTicketData:a.value,onRefreshTickets:T},null,8,["isOpen","currentTicketData"]),e("main",null,[e("div",lt,[e("h3",null,_(n(i)),1)]),e("div",ut,[(c(!0),l(w,null,G(t.value,(h,vt)=>(c(),D(q,{key:h._id,ticketData:h,onClick:ft=>b(h)},null,8,["ticketData","onClick"]))),128)),o.value?(c(),l("div",_t,[dt,d(O,{onClick:v},{default:y(()=>[m("前往訂票頁面")]),_:1})])):I("",!0)]),pt,d(P,{ticketsHistory:p.value,status:0},null,8,["ticketsHistory"])])],64)}}},bt=C(kt,[["__scopeId","data-v-d176b38e"]]);export{bt as default};
